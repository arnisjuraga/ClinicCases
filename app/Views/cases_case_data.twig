<div class="user_display ui-widget ui-corner-bottom user_widget" tabindex="1">

</div>

<div class="case_detail_panel_tools">

    <div class="case_detail_panel_tools_left">

        {% if (type == 'new') %}
            {{ "<b>Please enter new case data</b>" }}
        {% endif %}

        {% if (type == 'edit') %}
            {{ "<b>Edit Case Data below:</b>" }}
        {% endif %}


    </div>

    <div class="case_detail_panel_tools_right">

        {% if (type != 'new' and type != 'edit') %}
            {% if (_SESSION['permissions']['edit_cases'] == '1') %}
                <button class="case_data_edit">Edit</button>
            {% endif %}
            {% if (_SESSION['permissions']['delete_cases'] == '1') %}
                <button class="case_data_delete">Delete</button>
            {% endif %}
            <button class="case_data_print">Print</button>

        {% endif %}

    </div>

</div>

<div class="case_detail_panel_casenotes">


    {% if (type == 'new' or type == 'edit') %}

        <div class="new_case_data">

            <form>

                {% for d in dta %}
                    extract(d)

                    <p>
                        <label>{{ htmlspecialchars(display_name, constant('ENT_QUOTES'), 'UTF-8') }}</label>

                        {% if (input_type == 'text') %}

                            <input type="text" name="{{ db_name }}" value="{{ htmlspecialchars(value, constant('ENT_QUOTES'), 'UTF-8') }}">

                        {% elseif (input_type == 'date') %}

                            <input type="hidden" class="date_field" name="{{ db_name }}" value="{{ value }}">

                        {% elseif (input_type == 'multi-text') %}

                            {% if (value is not empty) %}
                                {% set items = unserialize(value) %}
                                {% for key,item in items %}

                                    <span class="{{ db_name ~ "_multi-text multi-text" }}">

                                        <input class="multi-text" name="{{ db_name }}" value="{{ htmlspecialchars(key, constant('ENT_QUOTES'), 'UTF-8') }}">

                                    </span>

                                {% endfor %}
                            {% else %}

                                <span class="{{ db_name ~ "_multi-text multi-text" }}">

                                    <input class="multi-text" name="{{ db_name }}">

                                </span>

                            {% endif %}
                        {% elseif (input_type == 'dual') %}

                            {% if (value is not empty) %}
                                {% set items = unserialize(value) %}
                                {% for key,val in items %}


                                    <span class="{{ db_name ~ "_dual dual_input" }}">

                                        <select class="dual" name="{{ db_name ~ '_select' }}">

                                            {% set options = unserialize(select_options) %}
                                            {% for o_key,o in options %}
                                                {% if (o_key == val) %}


                                                    <option selected=selected value="{{ htmlspecialchars(o_key, constant('ENT_QUOTES'), 'UTF-8') }}">
                                                        {{ htmlspecialchars(o, constant('ENT_QUOTES'), 'UTF-8') }}</option>
                                                {% else %}

                                                    <option value="{{ htmlspecialchars(o_key, constant('ENT_QUOTES'), 'UTF-8') }}">
                                                        {{ htmlspecialchars(o, constant('ENT_QUOTES'), 'UTF-8') }}</option>

                                                {% endif %}

                                            {% endfor %}

                                        </select>

                                        <input type="text" name="{{ db_name }}" value="{{ htmlspecialchars(key, constant('ENT_QUOTES'), 'UTF-8') }}">

                                    </span>

                                {% endfor %}
                            {% else %}

                                <span class="{{ db_name ~ "_dual dual_input" }}">

                                    <select class="dual" name="{{ db_name ~ '_select' }}">

                                        {% set options = unserialize(select_options) %}
                                        {% for o_key,o in options %}

                                            <option value="{{ o_key }}">{{ htmlspecialchars(o, constant('ENT_QUOTES'), 'UTF-8') }}</option>

                                        {% endfor %}

                                    </select>

                                    <input type="text" name="{{ db_name }}" value="">

                                </span>

                            {% endif %}

                        {% elseif (input_type == 'select') %}

                            <select name="{{ db_name }}">

                                <option value=""
                                <?=($type == 'new' ? "selected=selected": '') > ----

                                </option>

                                {% set s = unserialize(select_options) %}

                                {% for key,val in s %}

                                    {% if (val == value) %}
                                        {{ "<option value = '" ~ htmlspecialchars(val, constant('ENT_QUOTES'), 'UTF-8') ~ key ~
                                        htmlspecialchars(val, constant('ENT_QUOTES'), 'UTF-8') ~ "</option>" }}
                                    {% else %}
                                        {{ "<option value = '" ~ htmlspecialchars(val, constant('ENT_QUOTES'), 'UTF-8') ~ key ~
                                        htmlspecialchars(val, constant('ENT_QUOTES'), 'UTF-8') ~ "</option>" }}
                                    {% endif %}

                                {% endfor %}

                            </select>

                        {% elseif (input_type == 'select_multiple') %}

                            <select multiple name="{{ db_name }}">

                                {% for key,value in variable %}
                                    # code...
                                {% endfor %}

                            </select>

                        {% elseif (input_type == 'textarea') %}

                            <textarea name="{{ db_name }}">{{ htmlspecialchars(value, constant('ENT_QUOTES'), 'UTF-8') }}</textarea>

                        {% endif %}

                    </p>

                {% endfor %}

                <p style="text-align:center">
                    <button class="case_cancel_submit {% if (type == 'new') %}
 {{ 'cancel_new_case' }}
 {% endif %}">
                        Cancel
                    </button>

                    <button class="case_modify_submit {% if (type == 'new') %}
 {{ 'update_new_case' }}
 {% endif %}">
                        Submit
                    </button>
                </p>

            </form>

        </div>

    {% else %}

        <div class="case_data">

            {% for d in dta %}
                extract(d)

                {# special handling for dual inputs #}

                {% if (input_type == 'dual') %}

                    <div class="{{ db_name }}_display case_data_display">

                        <div class="case_data_name">{{ htmlspecialchars(display_name, constant('ENT_QUOTES'), 'UTF-8') }}</div>

                        {% if (value is not empty) %}
                            {% set duals = unserialize(value) %}

                            {% for v,type in duals %}
                                <div class="case_data_value">{{ v ~ " (" ~ type ~ ")" }}</div>
                            {% endfor %}

                        {% endif %}

                    </div>

                {% else %}

                    <div class="{{ db_name }}_display case_data_display">
                        <div class="case_data_name">{{ htmlspecialchars(display_name, constant('ENT_QUOTES'), 'UTF-8') }}</div>

                        <div class="case_data_value">

                            {# first check if this is a serialized value #}

                            {% set items = unserialize(value) %}
                            {% if (items != constant('false')) %}
                                {% set val = constant('null') %}

                                {% for key,item in items %}
{#                                    {% set val key ~ ", " = 'undefined' %}#}
                                {% endfor %}

                                {{ htmlspecialchars(substr(val, 0, -2), constant('ENT_QUOTES'), 'UTF-8') }}



                            {% elseif (input_type == 'date') %}
                                {# then check if it's a date #}
                                {{ sql_date_to_us_date(value) }}
                            {% else %}
                                {{ htmlspecialchars(value, constant('ENT_QUOTES'), 'UTF-8') }}
                            {% endif %}
                        </div>

                    </div>

                {% endif %}
            {% endfor %}

        </div>

    {% endif %}
</div>
